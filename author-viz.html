<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Explore Learning to Hash papers by Author</title>
  <meta name="description" content="Explore prolific authors and their contributions across Learning to Hash research" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css" />
  <style>
    #network-modal, #papers-modal {
      transition: opacity 0.3s ease;
    }
    #loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.5em;
      text-align: center;
      z-index: 1000;
      background: white;
      padding: 1em 2em;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    .highlight {
      background-color: #fffbcc !important;
      transition: background-color 0.5s ease;
    }
  </style>
</head>
<body>
  <h2 style="font-size: 1.8em; margin-bottom: 10px;">ğŸ” Author Explorer</h2>
  <p style="font-size: 1.1em;">
    Discover leading contributors in Learning to Hash research. Sort by paper count, citations, or timeline sparkline, color-coded by community, and click â€œViewâ€ to explore each authorâ€™s co-author graph.
  </p>
  <p style="font-size: 0.95em;">
    ğŸ” Authors are color-coded by <strong>community</strong>â€”clusters of frequent collaborators detected via graph algorithms. A red border marks high <span title="Betweenness centrality measures how often an author lies on the shortest paths between others. High values suggest strategic or well-connected positions.">betweenness</span>, indicating strong connectivity. â„¹ï¸ Hover over names for detailed network stats.
  </p>

  <!-- Loading Indicator -->
  <div id="loading"><p>Loading Author Network...</p></div>

  <table id="author-table" class="display stripe hover" style="width:100%; display:none;">
    <thead>
      <tr>
        <th data-priority="1">ğŸ‘¤ Author</th>
        <th data-priority="3">ğŸ“„ Papers</th>
        <th data-priority="4">ğŸ“Š Citations</th>
        <th title="ğŸ§© Number of direct co-author connections (degree centrality).">ğŸ§© Connections</th>
        <th title="ğŸ” Author influence score based on PageRank algorithm.">ğŸ” PageRank</th>
        <th title="ğŸ”„ Measures how tightly the author's co-authors are interconnected.">ğŸ”„ Clustering</th>
        <th data-priority="5">ğŸ“ˆ Paper Count Timeline</th>
        <th data-priority="6">ğŸ·ï¸ Tags</th>
        <th data-priority="2">ğŸ”— Network</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Modals -->
  <div id="network-modal" role="dialog" aria-modal="true" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:90%; height:90%; background:rgba(255,255,255,0.95); border:1px solid #ccc; z-index:10000; box-shadow:0 4px 20px rgba(0,0,0,0.2); border-radius:10px;">
    <button id="modal-close" aria-label="Close graph modal" style="position:absolute; top:10px; right:10px; padding:4px 8px; cursor:pointer;">âœ– Close</button>
    <svg id="network-svg" width="100%" height="100%"></svg>
  </div>

  <div id="papers-modal" role="dialog" aria-modal="true" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:80%; max-height:80%; overflow-y:auto; background:white; padding:20px; border-radius:10px; box-shadow:0 4px 20px rgba(0,0,0,0.2); z-index:10001;">
    <button id="papers-close" aria-label="Close papers list" style="position:absolute; top:10px; right:10px; padding:4px 8px; cursor:pointer;">âœ– Close</button>
    <h3 id="papers-title">Papers by Author</h3>
    <ul id="papers-list" style="font-size:0.95em;"></ul>
  </div>

  <div id="network-legend" style="display:none; font-size:0.85em; margin-top:8px; padding:0 5%;">
    â­• <strong>Circle size</strong> âˆ PageRank Â· ğŸ¨ <strong>Color</strong> = Community Â· ğŸ”´ Red border = selected author
  </div>

  <!-- JS libs -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.colVis.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery-sparkline@2.4.0/jquery.sparkline.min.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <!-- Main Script -->
  <script>
    let authorData;

    fetch('author_stats.json')
      .then(res => res.json())
      .then(data => {
        authorData = data;
        $('#loading').hide();
        $('#author-table').show();
        initAuthorTable(data);
      })
      .catch(err => {
        console.error('Error loading author stats', err);
        $('#loading').hide();
        $('#author-table').after('<div style="color:red; margin-top:10px;">Error loading author data.</div>');
      });

    function initAuthorTable(data) {
      const authors = Object.keys(data).filter(name => name.trim().split(/\s+/).length > 1);
      const communities = [...new Set(authors.map(a => data[a].community))];
      const pastelColors = ['#A1C9F4', '#FFB482', '#8DE5A1', '#FF9F9A', '#D0BBFF', '#DEBB9B', '#FAB0E4', '#CFCFCF', '#B9F2F0', '#FFFEA3'];
      const color = d3.scaleOrdinal(pastelColors).domain(communities);
      const betwVals = authors.map(a => data[a].betweenness);
      const threshold = d3.quantile(betwVals.sort(d3.ascending), 0.8);

      const rows = authors.map(author => {
        const info = data[author];
        const years = (info.sparkline_years || []).map(y => y.toString());
        const values = info.sparkline_values || [];
        const spark = values.join(',');
        const border = (info.betweenness || 0) > threshold ? ' border:2px solid red;' : '';
        const nameCell = `<span class="author-name" data-author="${author}" style="cursor:pointer; background:${color(info.community)}; padding:2px 6px; border-radius:4px;${border}" title="Community ${info.community} â€¢ Betweenness ${info.betweenness.toFixed(3)}">${author}</span>`;
        const tagsHtml = info.tags.map(tag => {
          const frag = encodeURIComponent(tag);
          return `<a href="https://learning2hash.github.io/tags.html#${frag}" target="_blank" rel="noopener" style="text-decoration:none; display:inline-block;"><span style="background:#f2f2f2; padding:2px 6px; border-radius:5px; margin-right:4px;">ğŸ·ï¸ ${tag}</span></a>`;
        }).join(' ');
        return [
          nameCell,
          info.paper_count,
          info.total_citations,
          info.degree?.toFixed(2) ?? 'â€”',
          info.pagerank?.toExponential(2) ?? 'â€”',
          info.clustering?.toFixed(2) ?? 'â€”',
          `<span class="sparkline" data-years="${years.join(',')}">${spark}</span>`,
          tagsHtml,
          `<button class="net-btn" data-author="${author}" style="padding:4px 8px; cursor:pointer;">View</button>`
        ];
      });

      const table = $('#author-table').DataTable({
        data: rows,
        dom: 'Bfrtip',
        responsive: { details: false },
        order: [[1, 'desc']],
        pageLength: 100,
        lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, 'All']],
        columnDefs: [
          { targets: [6, 8], orderable: false },
          { responsivePriority: 1, targets: 0 },
          { responsivePriority: 2, targets: 8 }
        ]
      });

      function drawSparks() {
        $('.sparkline').each(function () {
          const $el = $(this);
          const values = $el.text().split(',').map(Number);
          const years = ($el.attr('data-years') || '').split(',');
          $el.sparkline(values, {
            type: 'bar',
            height: '30px',
            barWidth: 7,
            barSpacing: 2,
            tooltipFormatter: (sp, options, fields) => {
              const idx = fields[0].offset;
              const val = fields[0].value;
              const year = years[idx] || 'Unknown';
              return `${val} papers in ${year}`;
            }
          });
        });
      }

      drawSparks();
      table.on('draw', drawSparks);

      $('#author-table').on('click', 'button.net-btn', function () {
        showNetwork($(this).data('author'));
      });

      $('#author-table').on('click', '.author-name', function () {
        const au = $(this).data('author');
        const info = data[au];
        $('#papers-title').text(`ğŸ“„ Papers by ${au}`);
        $('#papers-list').html((info.papers || []).map(p => `<li><a href="https://learning2hash.github.io/publications/${p.bibkey}/" target="_blank" rel="noopener">${p.title}</a> (${p.year})</li>`).join(''));
        $('#papers-modal').show();
      });

      $('#modal-close').on('click', () => $('#network-modal, #network-legend').fadeOut(200));
      $('#papers-close').on('click', () => $('#papers-modal').hide());
    }

    function getSubgraph(author, radius = 2, maxNodes = 150) {
      const visited = new Set();
      const queue = [{ id: author, depth: 0 }];
      const nodes = [];
      const links = [];
      const nodeIndex = new Map();

      while (queue.length > 0 && nodes.length < maxNodes) {
        const { id, depth } = queue.shift();
        if (!authorData[id] || visited.has(id)) continue;
        visited.add(id);

        const node = {
          id,
          depth,
          pagerank: authorData[id].pagerank ?? 0,
          community: authorData[id].community ?? 0,
        };

        nodes.push(node);
        nodeIndex.set(id, node);

        if (depth < radius && Array.isArray(authorData[id].coauthors)) {
          for (const co of authorData[id].coauthors) {
            if (!authorData[co]) continue;

            if (!links.some(l => (l.source === id && l.target === co) || (l.source === co && l.target === id))) {
              links.push({ source: id, target: co });
            }

            if (!visited.has(co) && !queue.some(q => q.id === co)) {
              queue.push({ id: co, depth: depth + 1 });
            }
          }
        }
      }

      const tooLarge = queue.length > 0 || nodes.length >= maxNodes;
      return { nodes, links, tooLarge };
    }

    function showNetwork(author) {
      $('#network-modal, #network-legend').fadeIn(200);
      $('#network-svg').data('current-author', author);
      const svg = d3.select('#network-svg');
      svg.selectAll('*').remove();

      const { nodes, links, tooLarge } = getSubgraph(author, 1);
      const { width: w, height: h } = svg.node().getBoundingClientRect();

      const sim = d3.forceSimulation(nodes)
        .force('link', d3.forceLink(links).id(d => d.id).distance(80))
        .force('charge', d3.forceManyBody().strength(-180))
        .force('center', d3.forceCenter(w / 2, h / 2));

      svg.append('g').selectAll('line').data(links).enter().append('line')
        .attr('stroke', '#aaa').attr('stroke-width', 1);

      const circleSelection = svg.append('g').selectAll('circle').data(nodes).enter().append('circle')
        .attr('r', d => 4 + Math.sqrt((authorData[d.id]?.pagerank || 0.001) * 500))
        .attr('fill', d => d3.schemePastel1[authorData[d.id]?.community % 10])
        .attr('stroke', d => d.id === author ? 'red' : '#333')
        .attr('stroke-width', d => 2 - 0.5 * d.depth)
        .style('cursor', 'pointer')
        .on('click', (e, d) => showNetwork(d.id));

      circleSelection.append('title')
        .text(d => `${d.id}\nPageRank: ${(authorData[d.id]?.pagerank || 0).toFixed(4)}\nDepth: ${d.depth}`);

      svg.append('g').selectAll('text').data(nodes).enter().append('text')
        .text(d => d.id).attr('font-size', '10px').attr('dx', 8).attr('dy', 4);

      sim.on('tick', () => {
        svg.selectAll('line')
          .attr('x1', d => d.source.x).attr('y1', d => d.source.y)
          .attr('x2', d => d.target.x).attr('y2', d => d.target.y);
        svg.selectAll('circle').attr('cx', d => d.x).attr('cy', d => d.y);
        svg.selectAll('text').attr('x', d => d.x).attr('y', d => d.y);
      });

      if (tooLarge) {
        svg.append('text')
          .attr('x', 10).attr('y', 20).attr('fill', 'red')
          .attr('font-size', '14px')
          .text('âš ï¸ Truncated: Too many nodes to display fully.');
      }

      const legendData = [
        'ğŸ–±ï¸ Single-click: Expand authorâ€™s local graph',
        'ğŸ–±ï¸ Double-click: Jump to table row for author',
        'ğŸ¨ Node color: Community',
        'ğŸ”´ Red border: Selected author'
      ];

      const legendGroup = svg.append('g')
        .attr('transform', `translate(20, ${h - 130})`);

      legendGroup.append('rect')
        .attr('x', -10).attr('y', -20)
        .attr('width', 280)
        .attr('height', legendData.length * 24)
        .attr('fill', '#f9f9f9')
        .attr('stroke', '#ccc')
        .attr('rx', 8).attr('ry', 8);

      const legendText = legendGroup.append('text')
        .attr('x', 0).attr('y', 0)
        .attr('font-size', '12px').attr('fill', '#333');

      legendText.selectAll('tspan')
        .data(legendData)
        .enter().append('tspan')
        .attr('x', 0)
        .attr('dy', (d, i) => i === 0 ? '0em' : '1.2em')
        .text(d => d);
    }
  </script>
</body>
</html>
