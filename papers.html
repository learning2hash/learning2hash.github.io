<!DOCTYPE html>
<html lang="en-us">

  <!-- _includes/head.html -->
<head>
  <!-- begin code v 7.0 -->
  <span id="wts2185304"></span>
  <script>
  var wts7 = {};
  wts7.invisible='';
  wts7.page_name='';
  wts7.group_name='';
  wts7.conversion_number='';
  wts7.user_id='';
  var wts=document.createElement('script');wts.async=true;
  wts.src='https://app.ardalio.com/wts7.js';document.head.appendChild(wts);
  wts.onload = function(){ wtsl7(2185304,4); };
  </script><noscript><img src="https://app.ardalio.com/7/4/2185304.png"></noscript>
  <!-- end code v 7.0 -->

 <!-- MathJax -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true
      },
      options: {
        // Only process elements with this class:
        processHtmlClass: 'mathjax-content',
        // And explicitly skip anything marked as no-mathjax
        ignoreHtmlClass: 'no-mathjax'
      }
    };
  </script>
  <script id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta charset="utf-8">

  <!-- Viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- âœ… Manual SEO keywords (specific to Learning to Hash) -->
  <meta name="keywords" content="learning to hash, machine learning, hashing, approximate nearest neighbour search, ANN, LSH, locality sensitive hashing, vector quantization, deep hashing, binary embeddings, information retrieval, similarity search">

  <!-- âœ… Jekyll SEO plugin (title, description, canonical, OG/Twitter, JSON-LD) -->
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Search all Publications on Learning to Hash | Awesome Learning to Hash</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Search all Publications on Learning to Hash" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A list of research papers for Learning to Hash." />
<meta property="og:description" content="A list of research papers for Learning to Hash." />
<link rel="canonical" href="https://learning2hash.github.io/papers.html" />
<meta property="og:url" content="https://learning2hash.github.io/papers.html" />
<meta property="og:site_name" content="Awesome Learning to Hash" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Search all Publications on Learning to Hash" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"A list of research papers for Learning to Hash.","headline":"Search all Publications on Learning to Hash","url":"https://learning2hash.github.io/papers.html"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Site CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="search" href="/public/opensearchdescription.xml" type="application/opensearchdescription+xml" title="learning2hash" />

  <!-- âœ… Single, modern jQuery + DataTables -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.7.0.min.js" defer></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js" defer></script>

  <!-- Optional sanity log -->
  <script defer>
    window.addEventListener('DOMContentLoaded', () => {
      console.log('jQuery:', jQuery?.fn?.jquery);
      console.log('DataTables loaded:', !!jQuery?.fn?.dataTable);
    });
  </script>
</head>


  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <body class="theme-base-0c layout-reverse">

    <!-- Ribbon -->
<a href='/contributing.html' class='ribbon'>Add your paper to Learning2Hash</a>

<!-- Sidebar -->
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">Awesome Learning to Hash</a>
      </h1>
      <p class="lead">A Webpage dedicated to the latest research on Hash Function Learning. Maintained by <a href="https://www.buymeacoffee.com/sjmoran">Sean Moran</a>.</p>
    </div>

    <nav class="sidebar-nav">
      <div class="sidebar-item">
        <p style="font-size: 12px">
          Search related work
          <input type="text" id="searchTarget" size="16" />
          <button type="button" onClick="search();">Go</button>
        </p>
      </div>

      <!-- NOTE: use quoted comparisons for page.url -->
      <a class="sidebar-nav-item active"
         href="/papers.html">All Papers</a>
      <a class="sidebar-nav-item"
         href="/tags.html">Papers by Tag</a>
      <a class="sidebar-nav-item"
         href="/tsne-viz.html">2D Map of Papers</a>
      <a class="sidebar-nav-item"
         href="/topic-viz.html">Topic Explorer</a>
      <a class="sidebar-nav-item"
         href="/opensource.html">Tools Explorer</a>
      <a class="sidebar-nav-item"
         href="/author-viz.html">Author Explorer</a>
      <a class="sidebar-nav-item"
         href="/tutorial.html">Tutorial</a>
      <a class="sidebar-nav-item"
         href="/resources.html">Resources, Courses &amp; Events</a>
      <a class="sidebar-nav-item"
         href="/contributing.html">Contributing</a>
    </nav>

    <!-- ===== Stay Updated (minimal block) ===== -->
    <hr style="border:none; border-top:1px solid #d8dee9; margin:0.75rem 0;" />
    <div class="sidebar-item" aria-label="Stay updated">
      <h3 style="margin:0 0 0.25rem 0; font-size:1rem;">Stay Updated</h3>
      <ul style="list-style:none; padding-left:0; margin:0;">
        <li style="margin:0.35rem 0;">
          <a class="sidebar-nav-item" href="/feed/publications.xml"
             rel="alternate" type="application/rss+xml">ðŸ“° RSS Feed</a>
        </li>
      </ul>
    </div>
    <!-- ===== End Stay Updated ===== -->

    <div class="sidebar-item">
      <p style="font-size: 12px">
        Contact <a href="https://sjmoran.github.io">Sean Moran</a> about this survey or website.
        <span style="font-size: 9px">
          Made with <a href="https://jekyllrb.com">Jekyll</a> and
          <a href="https://github.com/poole/hyde">Hyde</a>.
        </span>
      </p>
    </div>
  </div>
</div>

<style>
/* === Scrollable Right Sidebar (wider, matches Awesome LLM Papers) === */
.sidebar {
  position: fixed;
  top: 0;
  right: 0;
  height: 100vh;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 1.5rem 1.25rem;
  box-sizing: border-box;
  background-color: #7da2b3;
  scrollbar-gutter: stable;

  /* wider: 260â€“420px instead of 240â€“340px */
  width: clamp(260px, 30vw, 420px);
  max-width: clamp(260px, 30vw, 420px);
}

/* Allow normal flow inside sticky container */
.sidebar .container.sidebar-sticky {
  position: relative;
  max-height: none;
  overflow: visible;
}

/* Optional: prettier scrollbar */
.sidebar::-webkit-scrollbar { width: 8px; }
.sidebar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.25); border-radius: 4px; }
.sidebar::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.4); }

/* Match content offset */
.main, .content {
  margin-right: clamp(260px, 30vw, 420px);
}

/* Mobile view: sidebar collapses */
@media (max-width: 880px) {
  .sidebar {
    position: static;
    height: auto;
    width: auto;
    max-width: none;
    border-bottom: 1px solid rgba(0,0,0,0.08);
  }
  .main, .content {
    margin-right: 0 !important;
  }
}
</style>

<script defer>
document.addEventListener('DOMContentLoaded', function () {
  // ---- Search ----
  function doSearch() {
    const el = document.getElementById('searchTarget');
    if (!el) return;
    const q = el.value.trim();
    try { if (typeof ga === 'function') ga('send', 'event', 'search', 'search', q); } catch(e) {}
    window.location = "/papers.html#" + encodeURIComponent(q);
  }

  if (window.jQuery) {
    $('#searchTarget').on('keydown', function (e) {
      if (e.key === 'Enter') doSearch();
    });
    document.querySelector('.sidebar-item button')?.addEventListener('click', doSearch);
  } else {
    const input = document.getElementById('searchTarget');
    const btn = document.querySelector('.sidebar-item button');
    if (input) {
      input.addEventListener('keydown', function (e) {
        if (e.key === 'Enter') doSearch();
      });
    }
    if (btn) btn.addEventListener('click', doSearch);
  }

  window.search = doSearch;

  // ---- Match content margin to actual sidebar width ----
  const sb = document.querySelector('.sidebar');
  const mains = document.querySelectorAll('.main, .content');
  function syncSidebarWidth() {
    if (!sb) return;
    const w = sb.offsetWidth + 'px';
    mains.forEach(m => m && (m.style.marginRight = w));
  }
  syncSidebarWidth();
  window.addEventListener('resize', syncSidebarWidth);
});
</script>


    <div class="content container mathjax-content">
      <h2 style="font-size: 1.8em; margin-bottom: 10px;">ðŸ“š Search Publications</h2>
<p style="font-size: 1.05em;">
  Search across all papers in this collection. Use the search bar to filter by
  <strong>title</strong> and <strong>authors</strong>. Click a title to open the
  paperâ€™s page. <strong class="badge-new">NEW</strong> marks papers ingested in
  the past week.
</p>

<!-- Slim Toolbar: search + visible count + sort -->
<div id="papersToolbar" class="toolbar" style="display:none;">
  <!-- Top row: search bar -->
  <div class="search">
    <label for="papersSearch"><strong>Search</strong></label>
    <input id="papersSearch" type="search"
           placeholder="ðŸ” Search title or authorsâ€¦" inputmode="search" />
    <button id="resetPapersSearch" type="button" aria-label="Clear search">
      Clear
    </button>
  </div>

  <!-- Second row: count (left) + sort (right) -->
  <div class="toolbar-bottom">
    <span id="papersVisibleCount" class="small" aria-live="polite"></span>

    <div class="sort">
      <label for="sortSelect"><strong>Sort</strong></label>
      <select id="sortSelect">
        <option value="default">Newest &amp; NEW first</option>
        <option value="year_desc">Year â†“ (newest first)</option>
        <option value="year_asc">Year â†‘ (oldest first)</option>
        <option value="cites_desc">Citations â†“ (most first)</option>
        <option value="cites_asc">Citations â†‘ (fewest first)</option>
      </select>
    </div>
  </div>
</div>

<!-- Loading Indicator -->
<div id="loading" role="status" aria-live="polite">
  <p>Loading Publications â€¦</p>
</div>

<!-- Cards View -->
<div id="cardsGrid" class="cards" style="display:none;" aria-live="polite"></div>
<p id="emptyState" class="empty" style="display:none;">No papers match your search.</p>

<!-- Sentinel for progressive loading -->
<div id="loadMoreTrigger" style="height: 1px;"></div>

<!-- Hidden Data Table -->
<table id="papers-table" class="display stripe hover" style="width:100%; display:none;">
  <thead>
    <tr>
      <th>TitleHTML</th>
      <th>ShortAuthors</th>
      <th>Year</th>
      <th>Citations</th>
      <th>RawSearch</th>
      <th>AddedTS</th>
      <th>IsNew</th>
      <th>URL</th>
      <th>AllAuthors</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<style>
:root{
  --bg:#ffffff;
  --card:#fff;
  --muted:#6b7280;
  --line:#e5e7eb;
  --shadow:0 1px 2px rgba(0,0,0,.06), 0 8px 24px rgba(0,0,0,.04);
  --brand:#1a73e8;
}

/* Toolbar container */
.toolbar{
  position:sticky;
  top:0;
  z-index:20;
  background: linear-gradient(#fff, rgba(255,255,255,.92));
  backdrop-filter: blur(4px);
  border:1px solid var(--line);
  border-radius:12px;
  padding:10px 12px;
  margin:8px 0 12px;

  display:flex;
  flex-direction:column;
  align-items:stretch;
  gap:8px;
  box-shadow:var(--shadow);
}

/* Search (top row) */
.search{
  display:flex;
  align-items:center;
  gap:.6rem;
  flex-wrap:wrap;
}
.search label{
  font-weight:700;
  font-size:.85rem;
}
.search input{
  flex:1 1 220px;
  min-width:160px;
  max-width:560px;
  padding:.45rem .6rem;
  border:1px solid #cbd5e1;
  border-radius:8px;
  font-size:.95rem;
  background-color:#f8fafc;
}
.search input:focus{
  outline:none;
  border-color:var(--brand);
  box-shadow:0 0 0 2px rgba(26,115,232,.18);
}
.search button{
  padding:.45rem .6rem;
  font-size:.85rem;
  border:1px solid #cbd5e1;
  border-radius:8px;
  background:#f8fafc;
  cursor:pointer;
}
.search button:hover{
  background:#eef2f7;
}

/* Second row: count (left) + sort (right) */
.toolbar-bottom{
  display:flex;
  align-items:center;
  justify-content:space-between;
  flex-wrap:wrap;
  gap:.6rem;
}
.small{
  color:var(--muted);
  font-size:.9em;
}

/* Sort block */
.sort{
  display:flex;
  align-items:center;
  gap:.6rem;
  font-size:.85rem;
}
.sort label{
  font-weight:700;
  font-size:.85rem;
  color:#111827;
}
.sort select{
  padding:.45rem .6rem;
  border:1px solid #cbd5e1;
  border-radius:8px;
  background:#f8fafc;
  font-size:.95rem;
  line-height:1.3;
  appearance:none;
  -webkit-appearance:none;
  -moz-appearance:none;
  cursor:pointer;

  background-image:
    linear-gradient(45deg, #9ca3af 50%, transparent 50%),
    linear-gradient(135deg, #9ca3af 50%, transparent 50%);
  background-position:
    calc(100% - 14px) 50%,
    calc(100% - 9px) 50%;
  background-size:5px 5px;
  background-repeat:no-repeat;
  padding-right:1.7rem;
}
.sort select:hover{
  background-color:#eef2f7;
}
.sort select:focus{
  outline:none;
  border-color:var(--brand);
  box-shadow:0 0 0 2px rgba(26,115,232,.18);
}

/* Cards */
.cards{
  display:grid;
  gap:14px;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
}
.card{
  border:1px solid var(--line);
  border-radius:14px;
  background:var(--card);
  padding:14px;
  box-shadow: var(--shadow);
  transition: transform .06s ease;
}
.card:hover{
  transform: translateY(-1px);
}

.meta{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:8px;
  color:var(--muted);
  font-size:.9rem;
}

.title a{
  text-decoration:none;
  color:#0f172a;
}
.title a:hover{
  text-decoration:underline;
}

.badge-new{
  display:inline-block;
  font-size:.75rem;
  padding:.2rem .45rem;
  border-radius:999px;
  border:1px solid #ffe3a3;
  background:#fff6d8;
  color:#8a5a00;
}

/* Empty state */
.empty{
  color:var(--muted);
  text-align:center;
  padding:24px 8px;
}

/* Loader */
#loading{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:1.05em;
  background:white;
  padding:.8em 1.2em;
  border:1px solid #ccc;
  border-radius:8px;
  box-shadow:0 2px 10px rgba(0,0,0,.08);
}

/* Small screens */
@media (max-width: 640px){
  .toolbar-bottom{
    flex-direction:row;
    align-items:flex-start;
  }
  .sort{
    margin-left:auto;
  }
}
</style>

<link rel="stylesheet" href="/assets/vendor/datatables-1.13.6.min.css">
<link rel="stylesheet" href="/assets/vendor/dataTables.responsive-2.5.0.min.css">
<script src="/assets/vendor/jquery-3.6.0.min.js" defer></script>
<script src="/assets/vendor/datatables-1.13.6.min.js" defer></script>
<script src="/assets/vendor/dataTables.responsive-2.5.0.min.js" defer></script>

<script>
(function () {
  // ---------- Utilities ----------
  function readHashQuery() {
    const raw = window.location.hash ? window.location.hash.slice(1) : '';
    if (!raw) return '';
    try { return decodeURIComponent(raw.replace(/\+/g, ' ')); } catch { return raw; }
  }
  function setHash(q) {
    if (q && q.trim().length) history.replaceState(null, '', '#' + encodeURIComponent(q.trim()));
    else history.replaceState(null, '', location.pathname + location.search);
  }
  function escapeHtml(s) {
    return String(s)
      .replace(/&/g, '&amp;').replace(/</g, '&lt;')
      .replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
  }
  function toNumber(x) {
    if (x === null || x === undefined) return 0;
    if (typeof x === 'number') return x;
    const n = String(x).replace(/,/g, '').match(/-?\d+(\.\d+)?/);
    return n ? Number(n[0]) : 0;
  }
  function ts(s) {
    if (!s) return 0;
    const d = new Date(s);
    return isNaN(d.getTime()) ? 0 : Math.floor(d.getTime() / 1000);
  }
  function fmtDate(tsMs){
    if (!tsMs) return '';
    return new Date(tsMs).toLocaleString('en-GB', { day:'2-digit', month:'short', year:'numeric' });
  }

  // ---------- DOM refs ----------
  const loadingEl = document.getElementById('loading');
  const toolbarEl = document.getElementById('papersToolbar');
  const inputEl   = document.getElementById('papersSearch');
  const resetEl   = document.getElementById('resetPapersSearch');
  const countEl   = document.getElementById('papersVisibleCount');
  const gridEl    = document.getElementById('cardsGrid');
  const emptyEl   = document.getElementById('emptyState');
  const sortEl    = document.getElementById('sortSelect');
  const loadMoreTrigger = document.getElementById('loadMoreTrigger');

  let datatable;
  const PAGE_CHUNK = 80;      // how many cards to render at a time
  let visibleLimit = PAGE_CHUNK;
  let loadMoreObserver = null;

  function updateVisibleCount(){
    if (!datatable || !countEl) return;
    const total = datatable.rows({ filter:'applied' }).count();
    const shown = Math.min(visibleLimit, total);
    countEl.textContent = `Showing ${shown} of ${total} papers`;
  }

  function renderCards(){
    if (!datatable) return;

    const rows = datatable.rows({ filter:'applied' }).data().toArray();
    const total = rows.length;

    gridEl.innerHTML = '';

    if (!rows.length){
      gridEl.style.display='none';
      emptyEl.style.display='';
      if (loadMoreTrigger) loadMoreTrigger.style.display = 'none';
      updateVisibleCount();
      return;
    }

    emptyEl.style.display='none';
    gridEl.style.display='grid';

    // Ensure visibleLimit never exceeds available rows
    visibleLimit = Math.min(visibleLimit, total);

    const now = Math.floor(Date.now()/1000);
    const seven = 7*24*3600;

    const slice = rows.slice(0, visibleLimit);

    slice.forEach(r => {
      const titleHTML   = r[0];
      const shortAuth   = r[1] || '';
      const year        = +r[2] || '';
      const citations   = +r[3] || 0;
      const addedTs     = +r[5] || 0;
      const isNew       = !!r[6];
      const url         = r[7] || '';

      const showNew = isNew || (addedTs && (now - addedTs <= seven));

      const card = document.createElement('article');
      card.className = 'card';
      card.innerHTML = `
        <div class="meta">
          <span class="year" title="Year">${year || 'â€”'}</span>
          <span>â€¢</span>
          <span class="cites" title="Citations">${citations} cites</span>
          ${addedTs ? `<span>â€¢</span><time datetime="${new Date(addedTs*1000).toISOString()}">${fmtDate(addedTs*1000)}</time>` : ''}
        </div>
        <h3 class="title">${titleHTML}</h3>
        <div class="authors">${escapeHtml(shortAuth || 'â€”')}</div>
        <div class="badges">
          ${showNew ? '<strong class="badge-new">NEW</strong>' : ''}
        </div>
      `;

      if (url){
        const a = card.querySelector('.title a');
        if (!a){
          const h3 = card.querySelector('.title');
          h3.innerHTML = `<a href="${url}">${h3.textContent}</a>`;
        }
      }

      gridEl.appendChild(card);
    });

    // Show/hide the sentinel depending on whether there's more to load
    if (loadMoreTrigger){
      loadMoreTrigger.style.display = (visibleLimit < total) ? 'block' : 'none';
    }

    updateVisibleCount();
  }

  async function loadJSONs() {
    const [papersRes, histRes] = await Promise.all([
      fetch('/paper-abstracts.json', { cache: 'no-store' }),
      fetch('/assets/paper-history.json', { cache: 'no-store' })
    ]);
    if (!papersRes.ok) throw new Error('Failed to load paper-abstracts.json');
    if (!histRes.ok) throw new Error('Failed to load paper-history.json');
    const [papers, history] = await Promise.all([papersRes.json(), histRes.json()]);
    return { papers, history };
  }

  function buildRows(papers, history){
    const PAGE_URL_PREFIX = '' + '/publications/';
    const items = (history && history.items) ? history.items : {};

    const rows = papers.map(r => {
      const rawKey = r.key || '';
      const normKey = rawKey.toLowerCase().trim();

      const title = (r.title || '').trim();
      const url = (r.url && String(r.url)) ||
                  (normKey ? (PAGE_URL_PREFIX + encodeURIComponent(normKey)) : '');

      const shortAuthors = r.short_authors || (Array.isArray(r.authors)
        ? r.authors.slice(0,3).join(', ') + (r.authors.length > 3 ? ' et al.' : '')
        : (r.authors || ''));

      const allAuthors = Array.isArray(r.authors)
        ? r.authors.join(', ').trim()
        : (r.authors || '').trim();

      const year = toNumber(r.year);
      const citations = toNumber(r.citations);

      const hItem = items[normKey] || items[rawKey] || items[(rawKey || '').trim()] || {};
      const firstAdded = ts(hItem.first_added);

      const isNew = (firstAdded && (Math.floor(Date.now()/1000) - firstAdded) <= 7*24*3600) ? 1 : 0;

      const titleCell = url
        ? `<a href="${url}">${escapeHtml(title || '(untitled)')}</a>`
        : escapeHtml(title || '(untitled)');

      const raw = [
        title,
        shortAuthors,
        allAuthors,
        year,
        citations,
        rawKey
      ].join(' ').toLowerCase();

      return [
        titleCell,
        shortAuthors || 'â€”',
        year,
        citations,
        raw,
        firstAdded || 0,
        isNew,
        url,
        allAuthors || ''
      ];
    });

    return rows;
  }

  async function start(){
    try{
      const initialQuery = readHashQuery();
      if (inputEl && initialQuery) inputEl.value = initialQuery;

      const { papers, history } = await loadJSONs();
      const rows = buildRows(papers, history);

      const dt = jQuery('#papers-table').DataTable({
        data: rows,
        columns: [
          { title: "Title" },
          { title: "Authors" },
          { title: "Year" },
          { title: "Citations" },
          { title: "raw" },
          { title: "added_ts" },
          { title: "is_new" },
          { title: "url" },
          { title: "all_authors" }
        ],
        responsive: { details: false },
        autoWidth: false,
        paging: false,
        searching: true,   // keep filtering enabled
        info: false,       // hide "Showing 1â€“10 of N"
        dom: 't',          // only table body; removes built-in search bar / controls

        // Base sort; will be overridden by our custom sort logic in initComplete
        order: [[2,'desc'], [3,'desc']],
        columnDefs: [
          { targets: [5,6,7], visible: false, searchable: false },
          { targets: [4,8], visible: false, searchable: true },
          { targets: [2,3], type: 'num' }
        ],

        initComplete: function(){
          datatable = this.api();

          if (loadingEl) loadingEl.style.display='none';
          toolbarEl.style.display='';
          gridEl.style.display='grid';

          if (initialQuery) datatable.search(initialQuery).draw();

          renderCards();

          datatable.on('draw', renderCards);

          // Infinite-scroll style loading
          if ('IntersectionObserver' in window && loadMoreTrigger){
            loadMoreObserver = new IntersectionObserver((entries) => {
              entries.forEach(entry => {
                if (!entry.isIntersecting) return;
                const total = datatable.rows({ filter:'applied' }).count();
                if (visibleLimit < total) {
                  visibleLimit += PAGE_CHUNK;
                  renderCards();
                }
              });
            }, { rootMargin: '200px 0px' });

            loadMoreObserver.observe(loadMoreTrigger);
          }

          const debounce = (fn, ms=120) => {
            let t;
            return (...a) => {
              clearTimeout(t);
              t = setTimeout(() => fn(...a), ms);
            };
          };
          const apply = debounce(() => {
            const q = inputEl ? (inputEl.value || '') : '';
            visibleLimit = PAGE_CHUNK;  // reset visible cards when query changes
            datatable.search(q).draw(false);
            setHash(q);
          }, 120);

          inputEl.addEventListener('input', apply);
          inputEl.addEventListener('keydown', (e)=>{ if (e.key==='Enter'){ e.preventDefault(); apply(); }});

          resetEl.addEventListener('click', () => {
            inputEl.value = '';
            visibleLimit = PAGE_CHUNK;
            datatable.search('').draw(false);
            setHash('');
            inputEl.focus();
          });

          window.addEventListener('hashchange', () => {
            const q = readHashQuery();
            inputEl.value = q;
            visibleLimit = PAGE_CHUNK;
            datatable.search(q).draw(false);
          });

          document.addEventListener('keydown', (e) => {
            if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === 'k') {
              e.preventDefault();
              inputEl.focus();
            } else if (e.key === 'Escape') {
              inputEl.value='';
              visibleLimit = PAGE_CHUNK;
              datatable.search('').draw();
              setHash('');
            }
          });

          if (sortEl) {
            const applySort = (mode) => {
              switch (mode) {
                case 'year_desc':
                  // Year â†“ (newest first)
                  datatable.order([[2, 'desc'], [3, 'desc']]).draw(false);
                  break;
                case 'year_asc':
                  // Year â†‘ (oldest first)
                  datatable.order([[2, 'asc'], [3, 'desc']]).draw(false);
                  break;
                case 'cites_desc':
                  // Citations â†“
                  datatable.order([[3, 'desc'], [2, 'desc']]).draw(false);
                  break;
                case 'cites_asc':
                  // Citations â†‘
                  datatable.order([[3, 'asc'], [2, 'desc']]).draw(false);
                  break;
                case 'default':
                default:
                  // Newest & NEW first â†’ NEW flag, then ingestion timestamp, then year & citations
                  datatable.order([[6,'desc'], [5,'desc'], [2,'desc'], [3,'desc']]).draw(false);
                  break;
              }
            };

            sortEl.value = 'default';
            applySort('default');

            sortEl.addEventListener('change', () => {
              visibleLimit = PAGE_CHUNK;
              applySort(sortEl.value);
            });
          }

          setTimeout(() => datatable.columns.adjust().draw(false), 60);
        }
      });

    } catch (err){
      console.error(err);
      if (loadingEl) loadingEl.innerHTML = '<p style="color:#b00020">Sorry, failed to load publications.</p>';
    }
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', start, { once:true });
  } else {
    start();
  }
})();
</script>

    </div>

  </body>
</html>
