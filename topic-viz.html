---
layout: default
title: Explore Learning to Hash Papers by Topic
description: Interactive topic model explorer — adjust topic weights to see the most relevant papers
---

<meta name="viewport" content="width=device-width, initial-scale=1" />

<h2>Topic Explorer</h2>
<p>
  This page uses topic modelling to group Learning to Hash papers by their most important themes.
  Use the sliders to change topic importance and see the top matching papers update instantly.
</p>

<!-- ===== Full-bleed-to-right wrapper so sliders can use width up to sidebar ===== -->
<div class="full-bleed-right">
  <!-- ===== Compact, content-safe containers ===== -->
  <div class="content-wrap">
    <!-- Topic Filters (expanded by default) -->
    <details id="topicPanel" class="topic-panel" open>
      <summary>
        <span class="summary-left">
          <svg class="summary-caret" width="14" height="14" viewBox="0 0 20 20" aria-hidden="true">
            <path d="M7 5l6 5-6 5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
          <span><strong>Topic weights</strong></span>
          <button
            type="button"
            class="info"
            aria-label="Tip: Increase a slider to upweight that topic; Reset all returns sliders to zero."
            data-tooltip="Increase a slider to upweight that topic. ‘Reset all’ returns every slider to zero. Top results update live."
          >ⓘ</button>
        </span>

        <span class="summary-meta">
          <span id="activeSummary" class="small" aria-live="polite">No active weights</span>
          <button id="resetAll" type="button" class="reset-inline" aria-label="Reset all topic sliders">Reset all</button>
          <span id="expandHint" class="summary-hint" aria-hidden="true">Click to collapse</span>
        </span>
      </summary>

      <!-- Topic controls -->
      <div id="topicslider" class="topic-grid" aria-live="polite"></div>
    </details>
  </div>

  <!-- Results controls -->
  <div class="content-wrap" style="display:flex; align-items:center; gap:.5rem; margin:.25rem 0 .5rem;">
    <label for="resultCount" class="small"><strong>Show top</strong></label>
    <select id="resultCount" aria-label="Select number of results to display">
      <option value="20" selected>20</option>
      <option value="50">50</option>
      <option value="100">100</option>
      <option value="200">200</option>
      <option value="all">All</option>
    </select>
    <span id="resultMeta" class="small" aria-live="polite"></span>
  </div>

  <div class="content-wrap">
    <ul id="toppapers" class="pub-list">
      <li class="always-nowrap hint">Please move the sliders to look at the papers.</li>
    </ul>
  </div>
</div>

<style>
  :root{
    /* JS sets --sidebar-width dynamically (0 if no sidebar) */
    --sidebar-width: 0px;
    --page-gutter: clamp(12px, 2vw, 24px);
  }

  .full-bleed-right {
    width: 100%;
    max-width: min(100%, calc(100vw - var(--sidebar-width) - var(--page-gutter)));
    margin-right: auto;
    box-sizing: border-box;
  }

  .content-wrap { width: 100%; max-width: 100%; overflow: visible; }

  /* ========= Compact Panel ========= */
  .topic-panel {
    border: 1px solid #ececf2; border-radius: .6rem; background: #fff;
    margin: .35rem 0 .6rem; width: 100%;
  }
  .topic-panel > summary {
    list-style: none; cursor: pointer; display: flex; align-items: center; justify-content: space-between;
    gap: .5rem; padding: .45rem .6rem; font-weight: 600; user-select: none; flex-wrap: wrap;
  }
  .topic-panel > summary:hover { background: #fafbff; }
  .topic-panel > summary:focus-visible { outline: none; box-shadow: inset 0 0 0 2px rgba(26,115,232,.22); border-radius: .55rem; }
  .topic-panel[open] > summary { border-bottom: 1px solid #f0f0f0; }

  .summary-left { display:flex; align-items:center; gap:.45rem; flex-wrap:wrap; }
  .summary-caret { transition: transform .18s ease; transform-origin: 50% 50%; }
  .topic-panel[open] .summary-caret { transform: rotate(90deg); }

  .summary-meta { display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; }
  .summary-hint { color:#6b7280; font-size:.8rem; opacity:.9; }
  .small { color:#6b7280; font-size:.85rem; }

  @keyframes nudge { 0%,100%{transform:translateX(0)} 30%{transform:translateX(2px)} 60%{transform:translateX(-2px)} }
  .topic-panel.nudge .summary-caret { animation: nudge 700ms ease-in-out 2; }

  .reset-inline {
    padding: .25rem .5rem; border:1px solid #d9dbe3; border-radius:.4rem; background:#f8f9fb;
    font-size:.8rem; line-height:1; cursor:pointer;
  }
  .reset-inline:hover { background:#eef2f7; }

  /* ========= Slider grid: 3 per row ========= */
  .topic-grid {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: .55rem .65rem;
    padding: .55rem .6rem .6rem;
    width: 100%;
  }
  @media (max-width: 1100px) {
    .topic-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
  }
  @media (max-width: 640px) {
    .topic-grid { grid-template-columns: 1fr; }
  }

  /* ========= Topic row ========= */
  .topic-row {
    display: grid;
    grid-template-columns: 1fr auto;
    grid-template-rows: auto auto;
    grid-template-areas:
      "label label"
      "slider val";
    align-items: center;
    gap: .35rem .5rem;
    background: #fff; border-radius: .6rem; border: 1px solid #ececf2; padding: .6rem .6rem; width: 100%;
    overflow: hidden;
  }

  .topic-row .tag-chip {
    grid-area: label;
    display:inline-block; 
    box-sizing:border-box; 
    max-width: 100%;
    white-space: normal; 
    overflow-wrap:anywhere; 
    word-break: break-word; 
    hyphens:auto;
    text-decoration:none; 
    border-radius:.45rem; 
    padding:.15rem .4rem;
    background:#f6f7f9; 
    border:1px solid #e6e8ec;
    font-size: clamp(.65rem, .85vw, .85rem);
    line-height: 1.15; 
    color: inherit;
    margin: 0;
    width: 100%;
  }
  .topic-row .tag-chip .line { display:inline; }
  .topic-row .tag-chip .sep { opacity:.6; padding:0 .25ch; }

  .slider-wrap{
    grid-area: slider;
    width: 100%;
    max-width: 100%;
    min-width: 0;
    overflow: hidden;
  }

  .topic-row .val {
    grid-area: val;
    min-width: 2ch; text-align: right; font-variant-numeric: tabular-nums;
    font-size: .8rem; opacity: .85; padding-left: .1rem;
    justify-self: end;
  }

  /* ===== Compact slider ===== */
  .topic-row input[type="range"] {
    width: 100%;
    min-width: 0;
    display: inline-block;
    -webkit-appearance: none; appearance: none;
    height: 6px; border-radius: 999px; background: linear-gradient(90deg, #ddd, #eee);
    margin: 0; padding: 0; vertical-align: middle; touch-action: none;
  }
  .topic-row input[type="range"]:focus { outline: none; }
  .topic-row input[type="range"]:focus-visible { box-shadow: 0 0 0 2px #1a73e84d; }

  .topic-row input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none; appearance: none; width: 14px; height: 14px; border-radius: 50%;
    background: #1a73e8; border: 2px solid #fff; box-shadow: 0 0 0 1px #1a73e880; cursor: grab; margin-top: -4px;
  }
  .topic-row input[type="range"]::-moz-range-thumb {
    width: 14px; height: 14px; border-radius: 50%; background:#1a73e8; border: 2px solid #fff; box-shadow: 0 0 0 1px #1a73e880; cursor: grab;
  }
  .topic-row input[type="range"]::-moz-range-track { height: 6px; border-radius: 999px; background: #e9eaee; }

  /* ========= Publications list (fluid grid) ========= */
  .pub-list {
    margin: 0; padding-left: 0;
    display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: .45rem .6rem; width: 100%;
    align-items: start;
  }
  @media (min-width: 1400px) {
    .pub-list { grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); }
  }
  .pub-list li { 
    list-style: none; 
    margin: 0; 
    min-width: 0;
    white-space: normal;
    overflow-wrap: anywhere;
    word-break: break-word;
  }
  .pub-list li.always-nowrap {
    white-space: nowrap;
  }
  .pub-list li.hint {
    color: #6b7280;
    opacity: .95;
  }
  .pub-list a { 
    font-weight: 600; 
    overflow-wrap:anywhere; 
    word-break:break-word; 
  }

  /* Info icon + tooltip */
  .info {
    display:inline-flex; align-items:center; justify-content:center; width:18px; height:18px; line-height:18px; border-radius:50%;
    border:1px solid #999; background:#f8f8f8; font-size:.72rem; font-weight:700; cursor:pointer; padding:0; position:relative;
  }
  .info:focus { outline: none; box-shadow: 0 0 0 2px rgba(26,115,232,.25); }
  .info[data-tooltip]::after {
    content: attr(data-tooltip); position:absolute; left: 50%; transform: translateX(-50%); bottom: calc(100% + 8px);
    white-space: normal; max-width: 80vw; background:#222; color:#fff; padding:.35rem .5rem; border-radius:4px; font-size:.75rem;
    opacity:0; visibility:hidden; transition:opacity .15s ease; z-index:20;
  }
  .info[data-tooltip]::before {
    content:''; position:absolute; left:50%; transform:translateX(-50%); bottom: calc(100% + 3px); border:6px solid transparent; border-top-color:#222;
    opacity:0; visibility:hidden; transition:opacity .15s ease; z-index:20;
  }
  .info:hover::after, .info:hover::before,
  .info:focus::after, .info:focus::before,
  .info[data-show]::after, .info[data-show]::before { opacity:1; visibility:visible; }
</style>

<!-- Dynamic sidebar width (no hardcoding) -->
<script>
(function(){
  function findSidebar(){
    return document.querySelector('#sidebar, .sidebar, aside[role="complementary"], aside.sidebar');
  }
  function setSidebarWidth(){
    const el = findSidebar();
    const w = el ? Math.round(el.getBoundingClientRect().width) : 0;
    document.documentElement.style.setProperty('--sidebar-width', w + 'px');
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setSidebarWidth, { once:true });
  } else { setSidebarWidth(); }
  window.addEventListener('resize', setSidebarWidth);
  const s = findSidebar();
  if (s && 'ResizeObserver' in window) new ResizeObserver(setSidebarWidth).observe(s);
})();
</script>

<script>
  // Info tooltip toggle (click or focus)
  document.addEventListener('click', function(e){
    const isInfo = e.target.closest('.info[data-tooltip]');
    document.querySelectorAll('.info[data-show]').forEach(el => { if (el !== isInfo) el.removeAttribute('data-show'); });
    if (isInfo) { e.preventDefault(); isInfo.toggleAttribute('data-show'); }
  }, { passive: false });

  var all_papers = null;
  var num_topics = -1;

  // NEW: result count state (20/50/100/200/'all')
  var RESULTS_N = '20';

  function getUrlParam(name) {
    const params = new URLSearchParams(window.location.search);
    return params.get(name);
  }

  function isValidResultN(v){
    return v === 'all' || ['20','50','100','200'].includes(v);
  }

  function makeTopicRow(words, idx) {
    const id = 'topicSlider' + idx;
    const label = words.join(', ');
    const inline = words.map((w,i) =>
      `<span class="line">${w}</span>${i < words.length-1 ? '<span class="sep">·</span>' : ''}`
    ).join(' ');
    return `
      <div class="topic-row" data-idx="${idx}" data-text="${label.toLowerCase()}">
        <span class="tag-chip" title="${label}">${inline}</span>
        <div class="slider-wrap">
          <input type="range" min="0" max="10" value="0" id="${id}" aria-label="Weight for topic ${idx+1}: ${label}">
        </div>
        <span class="val" id="${id}Val">0</span>
      </div>
    `;
  }

  function hasActiveWeights() {
    for (let i = 0; i < num_topics; i++) {
      const w = Number(document.getElementById('topicSlider' + i).value) || 0;
      if (w > 0) return true;
    }
    return false;
  }

  function scorePaper(paper_id) {
    let score = 0;
    const topic_dist = all_papers[paper_id].topic_distr;
    for (let i = 0; i < num_topics; i++) {
      const w = Number(document.getElementById('topicSlider' + i).value) || 0;
      score += w * (topic_dist[i] || 0);
    }
    return score;
  }

  function updateActiveSummary() {
    const parts = [];
    for (let i = 0; i < num_topics; i++) {
      const w = Number(document.getElementById('topicSlider' + i).value) || 0;
      if (w > 0) parts.push(`#${i+1}:${w}`);
    }
    document.getElementById('activeSummary').textContent =
      parts.length ? `Active weights: ${parts.join('  ')}` : 'No active weights';
  }

  function renderPapers() {
    const $list = $("#toppapers").empty();

    if (!hasActiveWeights()) {
      $list.append('<li class="always-nowrap hint">Please move the sliders to look at the papers.</li>');
      updateActiveSummary();
      const meta = document.getElementById('resultMeta');
      if (meta) meta.textContent = '';
      return;
    }

    const paper_idxs = [];
    let maxScore = 0;

    for (let i = 0; i < all_papers.length; i++) {
      const s = scorePaper(i);
      paper_idxs.push([i, s]);
      if (s > maxScore) maxScore = s;
    }

    if (maxScore <= 0) {
      $list.append('<li class="always-nowrap hint">No matches for the current topic weights. Try increasing one or two sliders.</li>');
      updateActiveSummary();
      const meta = document.getElementById('resultMeta');
      if (meta) meta.textContent = '';
      return;
    }

    paper_idxs.sort((a, b) => b[1] - a[1]);

    const total = paper_idxs.length;
    const limit = (RESULTS_N === 'all') ? total : Math.min(Number(RESULTS_N), total);

    for (let i = 0; i < limit; i++) {
      const data = all_papers[paper_idxs[i][0]];
      $("#toppapers").append(`<li><a href="/publications/${data.key}">${data.title}</a>. ${data.year || ''}</li>`);
    }

    const meta = document.getElementById('resultMeta');
    if (meta) meta.textContent = `${limit} of ${total} papers shown`;
    updateActiveSummary();
  }

  function resetAll() {
    for (let i = 0; i < num_topics; i++) {
      const el = document.getElementById('topicSlider' + i);
      el.value = 0;
      document.getElementById('topicSlider' + i + 'Val').textContent = '0';
    }
    renderPapers();
  }

  $(document).ready(function() {
    // Preselect results via URL param ?n=20|50|100|200|all
    const nParam = getUrlParam('n');
    const rcEl = document.getElementById('resultCount');
    if (nParam && isValidResultN(nParam)) {
      rcEl.value = nParam;
      RESULTS_N = nParam;
    } else {
      RESULTS_N = rcEl.value;
    }

    // Change handler for results selector
    rcEl.addEventListener('change', () => {
      RESULTS_N = rcEl.value;
      renderPapers();
    });

    $.getJSON('/topics.json', function(data) {
      all_papers = data.paper_data;
      num_topics = data.topics.length;

      let html = '';
      for (let i = 0; i < num_topics; i++) {
        html += makeTopicRow(data.topics[i], i);
      }
      $("#topicslider").html(html);

      for (let i = 0; i < num_topics; i++) {
        const id = 'topicSlider' + i;
        $("#" + id).on("input change", function() {
          document.getElementById(id + 'Val').textContent = String(this.value);
          renderPapers();
        });
      }

      document.getElementById('resetAll').addEventListener('click', resetAll);

      renderPapers();

      const panel = document.getElementById('topicPanel');
      panel.open = true;
      panel.classList.add('nudge');
      setTimeout(() => panel.classList.remove('nudge'), 1600);

      const hint = document.getElementById('expandHint');
      function syncHint() { hint.textContent = panel.open ? 'Click to collapse' : 'Click to expand'; }
      syncHint();
      panel.addEventListener('toggle', syncHint);
    });
  });

  document.addEventListener('keydown', (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === 'r') {
      e.preventDefault();
      resetAll();
    }
  });
</script>
